# 拼豆图案转换器 - 使用文档

## 快速开始

### 安装与启动

```bash
# 安装依赖
npm install

# 启动开发服务器
npm run dev

# 生产构建
npm run build && npm start
```

启动后打开浏览器访问 `http://localhost:3000`。

---

## 界面布局

应用分为三个区域：

```
┌──────────────────────────────────────────────┐
│  顶部栏：应用标题                              │
├──────────┬───────────────────────────────────┤
│          │  工具栏（生成图案后显示）            │
│  左侧栏  ├───────────────────────────────────┤
│          │                                   │
│ · 图片上传│       主画布区域                   │
│ · 板尺寸  │    （拼豆图案预览/编辑）            │
│ · 调色板  │                                   │
│ · 用量统计│                                   │
│ · 导出    │                                   │
│          │                                   │
└──────────┴───────────────────────────────────┘
```

---

## 使用流程

### 第一步：上传图片

在左侧栏的上传区域：
- **拖拽上传**：将图片文件直接拖到虚线框内
- **点击上传**：点击虚线框，在弹出的文件选择器中选择图片

支持格式：JPG, PNG, GIF, WebP

上传成功后，虚线框变为原图预览。点击右上角的 `x` 按钮可移除图片重新上传。

### 第二步：配置拼豆板尺寸

在「拼豆板尺寸」区域选择目标尺寸：

| 预设 | 含义 |
|------|------|
| 29x29 | 单块标准拼豆板 |
| 58x29 | 两块板横向拼接 |
| 29x58 | 两块板纵向拼接 |
| 58x58 | 四块板拼接（大图案） |

也可以点击「自定义尺寸」输入任意宽高（5~200 颗）。

### 第三步：生成图案

点击蓝色的「生成拼豆图案」按钮。系统会：
1. 将原图降采样到目标尺寸
2. 对每个像素匹配最接近的 Artkal 拼豆颜色
3. 在主画布区域显示拼豆图案

---

## 图案预览操作

### 缩放

| 操作 | 方式 |
|------|------|
| 放大 | 鼠标滚轮向上滚动，或点击工具栏 `+` 按钮 |
| 缩小 | 鼠标滚轮向下滚动，或点击工具栏 `-` 按钮 |
| 重置 | 点击工具栏的百分比数字（如 `100%`） |

缩放以鼠标光标位置为中心。缩放范围：30% ~ 1500%。

### 平移

| 操作 | 方式 |
|------|------|
| 平移画布 | 按住 `Alt` 键 + 鼠标左键拖拽 |
| 平移画布 | 鼠标中键拖拽 |

### 显示选项

工具栏右侧的切换按钮：

| 按钮 | 功能 |
|------|------|
| 网格图标 | 开关网格线（每颗珠子的边框线） |
| `A` 字母 | 开关珠子编号（缩放到足够大时显示 Artkal 色号） |

---

## 手动编辑

### 切换到画笔模式

- 点击工具栏的画笔图标，或按键盘 `B` 键
- 光标变为十字准星

### 编辑单颗珠子

1. 在左侧「调色板」区域选择目标颜色
   - 可在搜索框输入颜色名称或编号（如 `C12` 或 `black`）
   - 「已使用」区显示当前图案中用到的颜色
2. 点击画布上要修改的珠子

### 撤销与重做

| 操作 | 快捷键 | 工具栏按钮 |
|------|--------|-----------|
| 撤销 | `Ctrl+Z` (Mac: `Cmd+Z`) | 左箭头按钮 |
| 重做 | `Ctrl+Y` (Mac: `Cmd+Y`) | 右箭头按钮 |

最多支持 50 步撤销历史。

### 切回选择模式

- 点击工具栏的箭头图标，或按键盘 `V` 键

---

## 用量统计

左侧栏「用量统计」区域自动显示：
- 顶部汇总：总颜色数 + 总珠子数
- 列表：每种颜色的色块预览、Artkal 编号、名称、数量
- 按数量降序排列

编辑珠子后统计数据实时更新。

---

## 导出

### 导出 PDF

点击「导出 PDF」按钮，生成包含：
- **第 1 页**（横版 A4）：完整图案网格
  - 自适应缩放填满页面
  - 板分割线（每 29 颗）
  - 珠子上标注色号（格子够大时）
- **第 2 页起**（纵版）：颜色图例表
  - 色块 + 编号 + 名称 + 数量
  - 底部显示总计

文件自动下载为 `bead-pattern-宽x高.pdf`。

### 导出 PNG

点击「导出 PNG」按钮，生成：
- 高分辨率图片（每颗珠子 30x30 像素）
- 珠子上标注 Artkal 色号
- 文件自动下载为 `bead-pattern-codes-宽x高.png`

---

## 键盘快捷键汇总

| 快捷键 | 功能 |
|--------|------|
| `V` | 切换到选择工具 |
| `B` | 切换到画笔工具 |
| `Ctrl+Z` / `Cmd+Z` | 撤销 |
| `Ctrl+Y` / `Cmd+Y` | 重做 |
| `Ctrl+Shift+Z` / `Cmd+Shift+Z` | 重做（备选） |
| 鼠标滚轮 | 缩放 |
| `Alt` + 鼠标拖拽 | 平移画布 |
| 鼠标中键拖拽 | 平移画布 |

---

## 色板说明

本应用使用 **Artkal C 系列** 5mm 拼豆色板，共 174 种颜色：
- C01 ~ C157：基础色系
- CE01 ~ CE17：扩展色系

颜色数据来源于社区校准数据 ([beadcolors](https://github.com/maxcleme/beadcolors))，RGB 值经过实物校准。

---

## 常见问题

### Q: 转换后的颜色看起来和原图差别很大？

这是正常现象。Artkal 色板只有 174 种离散颜色，无法完美还原连续色彩空间。以下情况差异会更明显：
- 渐变色（离散化后出现色带）
- 色板中缺少的特定色调（如荧光色、金属色）

建议：选择对比度较高、色彩较鲜明的图片作为输入。

### Q: 图案太大/太小怎么办？

调整「拼豆板尺寸」后重新点击「生成拼豆图案」即可。尺寸越大，图案细节越丰富，但制作难度和耗材也相应增加。

### Q: 可以修改单颗珠子的颜色吗？

可以。按 `B` 进入画笔模式，在调色板选颜色后点击珠子即可替换。所有修改都支持撤销。

### Q: 数据安全吗？

所有处理在浏览器本地完成，图片不会上传到任何服务器。关闭页面后所有数据清除。

### Q: 板分割线（粗线）是什么意思？

每 29 颗珠子的粗线表示实际拼豆板的边界。标准 Artkal 拼豆板为 29x29 颗。粗线帮助你在制作时知道需要在哪里换板或拼接。
